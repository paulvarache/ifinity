<script>
    (function (Ifinity) {
        class Ball /*extends Ifinity.RenderedObject*/ {

            constructor (ctx, world) {
                this.ctx = ctx;
                this.world = world;
                this.x = 0;
                this.y = 0;
                this.vx = 0;
                this.vy = 0;
                this.size = 5;
                this.color = '#00BFFF';
                this.angle = 90;
                this.lastCollision = null;
            }

            update (dt) {
                if (this.removed) {
                    return;
                }

                let cols = this.world.getCollisions(this.id),
                    collidedElement,
                    direction;

                cols.forEach(elem => {
                    if (elem !== this.lastCollision) {
                        collidedElement = this.world.get(cols[0]).data;

                        if ("angle" in collidedElement) {
                            this.angle = collidedElement.angle;
                            direction = this.angle * Math.PI / 180;
                            this.vx = Math.cos(direction) * 2;
                            this.vy = Math.sin(direction) * 2;
                        } else if ("acceptedColor" in collidedElement) {
                            if (this.color == collidedElement.acceptedColor) {

                                // Display the animation

                                this.world.remove(this.id);
                                this.removed = true;

                                return;
                            }
                        } else {
                            console.log("Don't know how to deal with this kind of collision ", collidedElement);
                        }


                        this.lastCollision = elem;
                    }
                });

                if (!this.removed) {
                    let box = this.world.move(this.id, this.vx, this.vy, this.angle);
                    this.x = box.x;
                    this.y = box.y;
                }
            }

            render () {
                this.ctx.save();
                this.ctx.translate(this.x, this.y);
                this.ctx.fillStyle = this.color;
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(0, 0, this.size, 0, 2 * Math.PI);
                this.ctx.fill();
                this.ctx.closePath();
                this.ctx.restore();
            }
        }

        Ifinity.Ball = Ball;

    })(window.Ifinity = window.Ifinity || {});
</script>
